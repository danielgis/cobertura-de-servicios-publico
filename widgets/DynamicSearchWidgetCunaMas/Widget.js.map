{"version":3,"sources":["../../../widgets/DynamicSearchWidgetCunaMas/Widget.js"],"names":["declare","BaseWidget","_WidgetsInTemplateMixin","WidgetManager","QueryTask","Query","Deferred","all","BusyIndicator","Message","jquery","select2","fontAwesome","document","createElement","src","head","appendChild","select2Css","rel","href","isFirstLoad","baseClass","groupSelected","urlLayerSelected","whereDefault","postCreate","inherited","arguments","map","on","executeZoomExtentInitial","bind","showMessageCs","message","type","title","nls","widgetTitle","titleLabel","onClickGroup","evt","indexGroupSelected","Array","from","target","parentNode","children","indexOf","config","groups","find","group","index","buildFormRadioCs","buildFormSearchCs","buildHeaderSearchCs","containerGroupsApCs","classList","toggle","containerFiltersApCs","onClickBack","destroyFormSearchCs","startup","busyIndicator","create","domNode","backgroundOpacity","onOpen","buildMainMenuCs","dojo","query","executeHomeExtent","homeWidget","getInstance","getWidgetsByName","setExtent","homeDijit","extent","sort","a","b","containerGridApCs","innerHTML","length","containerBackApCs","remove","forEach","img","logo","alt","name","add","setAttribute","label","style","color","description","containerImgSelectedApCs","layersForm","makeSelectorLayers","layers","visible","radioContainerApCs","show","filters","containerBodyApCs","labelReset","restoreLabelCs","addEventListener","resetAllOpionSelected","filter","select","id","codeField","startupData","urlFilter","url","fieldsFilter","nameField","getDataByFilter","then","response","features","$","prop","makeOptionCs","firstOption","catch","console","error","err","event","onChangeFilterCs","tags","placeholder","hide","fields","where","distinctValues","deferred","queryTask","outFields","returnGeometry","returnDistinctValues","execute","resolve","reject","promise","setExtentByFilter","expand","self","executeForExtent","destroyFormRadioCs","options","selectControl","valueField","labelField","fixOptionSelected","selectedValue","selectedIndex","value","phOption","text","restoreOption","selected","optionElement","option","attributes","toString","currentFilterIndex","manageWhere","currentFilter","currentTarget","dispatchEvent","Event","responseFilter","layersSelected","webmap","isZoom","anotherZoom","geometry","centerAndZoom","Error","labelLayerSelected","whereLimit","manageWhereLimits","getLayer","idLayer","setDefinitionExpression","promises","data","getElementById","layersId","verifyFields","layer","includes","field","getCountByWhere","ulr","executeForCount","formRadioContainersApCs","idSelected","radioItemContainer","input","for","display","handleRadioButtonClick","checked","click","layerSelected","layerId","setVisibility","push","join"],"mappings":"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","file":"Widget.js","sourcesContent":["import declare from 'dojo/_base/declare';\r\nimport BaseWidget from 'jimu/BaseWidget';\r\nimport _WidgetsInTemplateMixin from 'dijit/_WidgetsInTemplateMixin';\r\nimport WidgetManager from \"jimu/WidgetManager\"\r\nimport QueryTask from \"esri/tasks/QueryTask\";\r\nimport Query from \"esri/tasks/query\";\r\nimport Deferred from \"dojo/Deferred\";\r\nimport all from \"dojo/promise/all\";\r\nimport BusyIndicator from 'esri/dijit/util/busyIndicator';\r\nimport Message from \"jimu/dijit/Message\";\r\nimport jquery from 'https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js';\r\nimport select2 from 'https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js';\r\n\r\nconst fontAwesome = document.createElement('script');\r\nfontAwesome.src = 'https://use.fontawesome.com/releases/v5.3.1/js/all.js';\r\ndocument.head.appendChild(fontAwesome);\r\n\r\nconst select2Css = document.createElement('link');\r\nselect2Css.rel = 'stylesheet';\r\nselect2Css.href = 'https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css';\r\ndocument.head.appendChild(select2Css);\r\n\r\nlet isFirstLoad = false;\r\n\r\n// To create a widget, you need to derive from BaseWidget.\r\nexport default declare([BaseWidget], {\r\n\r\n  // Custom widget code goes here\r\n\r\n  baseClass: 'dynamic-search-widget-cuna-mas',\r\n  groupSelected: null,\r\n  urlLayerSelected: null,\r\n  whereDefault: '1=1',\r\n\r\n  // add additional properties here\r\n\r\n  // methods to communication with app container:\r\n  postCreate() {\r\n    this.inherited(arguments);\r\n    this.map.on(\"update-end\", this.executeZoomExtentInitial.bind(this));\r\n  },\r\n\r\n  showMessageCs(message, type = 'message') {\r\n    const title = `${this.nls.widgetTitle}`;\r\n    new Message({\r\n      type: type,\r\n      titleLabel: title,\r\n      message: message,\r\n    });\r\n  },\r\n\r\n  onClickGroup(evt) {\r\n    const indexGroupSelected = Array.from(evt.target.parentNode.children).indexOf(evt.target);\r\n    this.groupSelected = this.config.groups.find(group => group.index === indexGroupSelected);\r\n    this.buildFormRadioCs();\r\n    this.buildFormSearchCs();\r\n    this.buildHeaderSearchCs();\r\n    this.containerGroupsApCs.classList.toggle('active');\r\n    this.containerFiltersApCs.classList.toggle('active');\r\n  },\r\n\r\n  onClickBack(evt) {\r\n    this.containerGroupsApCs.classList.toggle('active');\r\n    this.containerFiltersApCs.classList.toggle('active');\r\n    this.destroyFormSearchCs();\r\n    this.urlLayerSelected = null;\r\n  },\r\n\r\n  startup() {\r\n    this.inherited(arguments);\r\n    this.busyIndicator = BusyIndicator.create({\r\n      target: this.domNode.parentNode.parentNode,\r\n      backgroundOpacity: 0\r\n    });\r\n  },\r\n  onOpen() {\r\n    this.buildMainMenuCs();\r\n    dojo.query(\".groupFilterClsCs\").on('click', this.onClickGroup.bind(this));\r\n    dojo.query(\".backButtonClsCs\").on('click', this.onClickBack.bind(this));\r\n  },\r\n\r\n  executeZoomExtentInitial() {\r\n    if (isFirstLoad) {\r\n      return;\r\n    }\r\n    this.executeHomeExtent();\r\n    // const homeWidget = WidgetManager.getInstance().getWidgetsByName(\"HomeButton\");\r\n    // this.map.setExtent(homeWidget[0].homeDijit.extent);\r\n    isFirstLoad = true;\r\n  },\r\n  executeHomeExtent() {\r\n    const homeWidget = WidgetManager.getInstance().getWidgetsByName(\"HomeButton\");\r\n    this.map.setExtent(homeWidget[0].homeDijit.extent);\r\n  },\r\n\r\n  buildMainMenuCs() {\r\n    this.config.groups.sort((a, b) => a.index - b.index);\r\n    this.containerGridApCs.innerHTML = '';\r\n    if (this.config.groups.length == 1) {\r\n      this.groupSelected = this.config.groups[0];\r\n      this.containerBackApCs.classList.remove('active');\r\n      this.buildFormRadioCs();\r\n      this.buildFormSearchCs();\r\n      this.buildHeaderSearchCs();\r\n      this.containerGroupsApCs.classList.toggle('active');\r\n      this.containerFiltersApCs.classList.toggle('active');\r\n      return;\r\n    }\r\n    this.config.groups.forEach(group => {\r\n      const img = document.createElement('img');\r\n      img.src = group.logo;\r\n      img.alt = group.name;\r\n      img.classList.add('groupFilterClsCs', 'groupCs');\r\n      img.setAttribute('data-dojo-attach-point', 'scdApCs');\r\n      this.containerGridApCs.appendChild(img);\r\n    });\r\n  },\r\n\r\n  buildHeaderSearchCs() {\r\n    dojo.query('#nameSelectedCs')[0].innerHTML = this.groupSelected.label;\r\n    dojo.query('#nameSelectedCs')[0].style.color = this.groupSelected.color;\r\n    dojo.query('#descSelectedCs')[0].innerHTML = this.groupSelected.description;\r\n    dojo.query('#descSelectedCs')[0].style.color = this.groupSelected.color;\r\n    const img = document.createElement('img');\r\n    img.src = this.groupSelected.logo;\r\n    img.alt = this.groupSelected.name;\r\n    img.classList.add('groupFilterClsCs', 'groupCs');\r\n    img.setAttribute('data-dojo-attach-point', 'scdApCs');\r\n    this.containerImgSelectedApCs.innerHTML = '';\r\n    this.containerImgSelectedApCs.appendChild(img);\r\n  },\r\n\r\n  buildFormRadioCs() {\r\n    if (this.groupSelected.layersForm) {\r\n      this.makeSelectorLayers(this.groupSelected.layersForm.layers);\r\n      if (this.groupSelected.layersForm.visible) {\r\n        this.radioContainerApCs.classList.add('active');\r\n      } else {\r\n        this.radioContainerApCs.classList.remove('active');\r\n      }\r\n    } else {\r\n      this.radioContainerApCs.classList.remove('active');\r\n    }\r\n  },\r\n\r\n  buildFormSearchCs() {\r\n    this.busyIndicator.show();\r\n    const filters = this.groupSelected.filters;\r\n    filters.sort((a, b) => a.index - b.index);\r\n    this.containerBodyApCs.innerHTML = '';\r\n\r\n    const labelReset = document.createElement('p');\r\n    labelReset.classList.add('resetFilterClsCs');\r\n    labelReset.innerHTML = this.nls.restoreLabelCs;\r\n    this.containerBodyApCs.appendChild(labelReset);\r\n\r\n    labelReset.addEventListener('click', this.resetAllOpionSelected.bind(this));\r\n\r\n    filters.forEach((filter, index) => {\r\n      const label = document.createElement('p');\r\n      label.classList.add('labelComboBoxClsCs');\r\n      label.innerHTML = filter.label;\r\n      this.containerBodyApCs.appendChild(label);\r\n\r\n      const select = document.createElement('select');\r\n      select.classList.add('comboBoxClsCs');\r\n      select.classList.add('form-control');\r\n      select.classList.add('js-example-tags');\r\n      // select.classList.add('select2');\r\n      select.id = filter.codeField;\r\n      if (filter.startupData) {\r\n        const urlFilter = this.urlLayerSelected || filter.url;\r\n        const fieldsFilter = [filter.codeField, filter.nameField];\r\n        this.getDataByFilter(urlFilter, fieldsFilter)\r\n          .then(response => {\r\n            if (response.features.length === 1000) {\r\n              // disable select\r\n              $(`#${filter.codeField}`).prop(\"disabled\", true);\r\n            } else {\r\n              $(`#${filter.codeField}`).prop(\"disabled\", false);\r\n              this.makeOptionCs(response.features, select, filter.codeField, filter.nameField, filter.firstOption);\r\n            }\r\n          })\r\n          .catch(err => {\r\n            console.error('err', err);\r\n          });\r\n\r\n      };\r\n      this.containerBodyApCs.appendChild(select);\r\n      $(`#${filter.codeField}`).on('select2:select', (event) => this.onChangeFilterCs(event, index));\r\n      // $(`#${filter.codeField}`).on('select2:clear', (event) => this.onChangeFilterCs(event, index));\r\n      $(`#${filter.codeField}`).select2({\r\n        tags: true,\r\n        placeholder: filter.firstOption,\r\n        // allowClear: true\r\n      });\r\n    });\r\n    this.busyIndicator.hide();\r\n  },\r\n\r\n  getDataByFilter(url, fields, where = this.whereDefault, distinctValues = true) {\r\n    const deferred = new Deferred();\r\n    const queryTask = new QueryTask(url);\r\n    const query = new Query();\r\n    query.outFields = fields;\r\n    query.where = where;\r\n\r\n    query.returnGeometry = distinctValues ? false : true;\r\n    query.returnDistinctValues = distinctValues;\r\n\r\n    queryTask.execute(query)\r\n      .then(response => {\r\n        deferred.resolve(response);\r\n      })\r\n      .catch(err => {\r\n        deferred.reject(err);\r\n      });\r\n    return deferred.promise;\r\n  },\r\n\r\n  setExtentByFilter(url, where, expand = 1.1) {\r\n    const self = this;\r\n    const deferred = new Deferred();\r\n    const queryTask = new QueryTask(url);\r\n    const query = new Query();\r\n    query.where = where;\r\n    query.returnGeometry = true;\r\n\r\n    queryTask.executeForExtent(query)\r\n      .then(response => {\r\n        self.map.setExtent(response.extent.expand(expand), true);\r\n        deferred.resolve(response);\r\n      })\r\n      .catch(err => {\r\n        console.error('err', err);\r\n        deferred.reject(err);\r\n      });\r\n    return deferred.promise;\r\n  },\r\n\r\n  destroyFormSearchCs() {\r\n    this.containerBodyApCs.innerHTML = '';\r\n  },\r\n\r\n  destroyFormRadioCs() {\r\n    this.radioContainerApCs.innerHTML = '';\r\n  },\r\n\r\n  makeOptionCs(options, selectControl, valueField, labelField, firstOption, fixOptionSelected = true) {\r\n    let selectedValue = null;\r\n    if (fixOptionSelected) {\r\n      const selectedIndex = selectControl.selectedIndex;\r\n      if (selectedIndex > 1) {\r\n        selectedValue = selectControl.options[selectedIndex].value;\r\n      }\r\n    }\r\n    selectControl.innerHTML = '';\r\n    const phOption = document.createElement('option');\r\n    phOption.text = firstOption;\r\n    phOption.value = '';\r\n    selectControl.appendChild(phOption);\r\n\r\n    const restoreOption = document.createElement('option');\r\n    // restoreOption.text = firstOption;\r\n    restoreOption.text = 'Vacío';\r\n    restoreOption.value = '0';\r\n    restoreOption.selected = false;\r\n    // restoreOption.disabled = true;\r\n    selectControl.appendChild(restoreOption);\r\n\r\n    options.forEach(option => {\r\n      const optionElement = document.createElement('option');\r\n      optionElement.value = option.attributes[valueField];\r\n      optionElement.innerHTML = option.attributes[labelField];\r\n      if (selectedValue && selectedValue.toString() === option.attributes[valueField].toString()) {\r\n        optionElement.selected = true;\r\n      }\r\n      selectControl.appendChild(optionElement);\r\n    });\r\n  },\r\n\r\n  onChangeFilterCs(evt, currentFilterIndex) {\r\n    this.busyIndicator.show();\r\n    let where = this.manageWhere();\r\n    if (where === '') {\r\n      where = this.whereDefault;\r\n    }\r\n    const selectedIndex = evt.target.selectedIndex;\r\n    const selectedValue = evt.target.options[selectedIndex].value;\r\n    const currentFilter = this.groupSelected.filters[currentFilterIndex];\r\n\r\n    if (selectedValue === '0') {\r\n      // si se selecionar \"vacio\" con un value igual a 0; el select no debe tener ningun valor seleccionado\r\n      evt.currentTarget.value = '';\r\n      // evt.currentTarget.options[0].selected = true;\r\n      evt.currentTarget.dispatchEvent(new Event('change'));\r\n    };\r\n\r\n    const fields = [currentFilter.codeField, currentFilter.nameField];\r\n    // const where = `${currentFilter.codeField} = '${selectedValue}'`;\r\n\r\n    let responseFilter;\r\n\r\n    const url = this.urlLayerSelected || currentFilter.url;\r\n    const layersSelected = this.layersSelected;\r\n\r\n    const webmap = this.map;\r\n\r\n    return this.getDataByFilter(url, fields, where, false)\r\n      .then((response) => {\r\n        responseFilter = response;\r\n        if (!currentFilter.isZoom && !currentFilter.anotherZoom) {\r\n          return null;\r\n        }\r\n        if (currentFilter.isZoom) {\r\n          if (responseFilter.features.length === 1 && responseFilter.features[0].geometry.type === 'point') {\r\n            return this.map.centerAndZoom(responseFilter.features[0].geometry, 17);\r\n          }\r\n          if (responseFilter.features.length === 0) {\r\n            throw new Error(`No se encontraron resultados de ${this.labelLayerSelected} en esta ubicación`);\r\n            // console.log(\"No se encontraron resultados\");\r\n            // return;\r\n          }\r\n          return this.setExtentByFilter(url, where);\r\n        };\r\n        if (currentFilter.anotherZoom) {\r\n          const whereLimit = this.manageWhereLimits();\r\n          webmap.getLayer(currentFilter.anotherZoom.idLayer).setDefinitionExpression(whereLimit)\r\n          // if (selectedValue === '0') {\r\n          //   return;\r\n          // };\r\n          // const whereAnother = `${currentFilter.anotherZoom.field} = '${selectedValue}'`;\r\n          return this.setExtentByFilter(currentFilter.anotherZoom.url, whereLimit, expand = 1);\r\n        };\r\n      })\r\n      .then(() => {\r\n        if (responseFilter.features.length === 0) {\r\n          return;\r\n        }\r\n        const promises = this.groupSelected.filters.map((filter, index) => {\r\n          if (selectedValue === '0') {\r\n            const urlFilter = this.urlLayerSelected || filter.url;\r\n            const fieldsFilter = [filter.codeField, filter.nameField];\r\n            return this.getDataByFilter(urlFilter, fieldsFilter, where)\r\n              .then(data => {\r\n                if (data.features.length === 1000) {\r\n                  // disable select\r\n                  $(`#${filter.codeField}`).prop(\"disabled\", true);\r\n                } else {\r\n                  $(`#${filter.codeField}`).prop(\"disabled\", false);\r\n                  this.makeOptionCs(data.features, document.getElementById(filter.codeField), filter.codeField, filter.nameField, filter.firstOption);\r\n                }\r\n\r\n              });\r\n          }\r\n          else if (evt.target.id !== filter.codeField) {\r\n            const urlFilter = this.urlLayerSelected || filter.url;\r\n            const fieldsFilter = [filter.codeField, filter.nameField];\r\n            return this.getDataByFilter(urlFilter, fieldsFilter, where)\r\n              .then(data => {\r\n                if (data.features.length === 1000) {\r\n                  // disable select\r\n                  $(`#${filter.codeField}`).prop(\"disabled\", true);\r\n                } else {\r\n                  $(`#${filter.codeField}`).prop(\"disabled\", false);\r\n                  this.makeOptionCs(data.features, document.getElementById(filter.codeField), filter.codeField, filter.nameField, filter.firstOption);\r\n                }\r\n              });\r\n          }\r\n        });\r\n        return all(promises);\r\n        // this.groupSelected.filters.forEach(filter => {\r\n        // makeOption by each filter\r\n\r\n        // });\r\n        //   if (!currentFilter.filterAffected) {\r\n        //     return;\r\n        //   }\r\n        //   currentFilter.filterAffected.forEach(affectedIndex => {\r\n        //     const affectedFilter = this.groupSelected.filters[affectedIndex];\r\n        //     const affectedSelect = document.getElementById(affectedFilter.codeField);\r\n        //     const urlFilter = this.urlLayerSelected || affectedFilter.url;\r\n        //     const fieldsFilter = [affectedFilter.codeField, affectedFilter.nameField];\r\n        //     const whereFilter = `${currentFilter.codeField} = '${selectedValue}'`;\r\n        //     this.getDataByFilter(urlFilter, fieldsFilter, whereFilter)\r\n        //       .then(data => {\r\n        //         this.makeOptionCs(data.features, affectedSelect, affectedFilter.codeField, affectedFilter.nameField, affectedFilter.firstOption);\r\n        //       })\r\n        //       .then(() => {\r\n        //         let filterAffectedReset = affectedFilter.filterAffected;\r\n        //         while (filterAffectedReset.length > 0) {\r\n        //           filterAffectedReset = this.resetSelectIndexArray(filterAffectedReset);\r\n        //         }\r\n        //       })\r\n        //       .catch(err => {\r\n        //         console.error(`Error al actualizar el filtro ${affectedFilter.label}:`, err);\r\n        //       });\r\n        //   });\r\n      })\r\n      .then(() => {\r\n        layersSelected.layersId.forEach(layer => {\r\n          // console.log('layer', layer);\r\n          // search fields in where, but not set definition expression\r\n          const verifyFields = webmap.getLayer(layer).fields.filter(field => {\r\n            if (where.includes(field.name)) {\r\n              return field.name;\r\n            };\r\n\r\n          });\r\n\r\n          if (verifyFields.length === 0) {\r\n            return;\r\n          }\r\n          webmap.getLayer(layer).setDefinitionExpression(where);\r\n        });\r\n        // return all(promises);\r\n        this.busyIndicator.hide();\r\n      })\r\n      .catch(err => {\r\n        this.showMessageCs(err.message, 'error');\r\n        // console.error('err', err);\r\n        this.busyIndicator.hide();\r\n      });\r\n  },\r\n\r\n  // resetSelectIndexArray(indexArray) {\r\n  //   const newAffectedFilters = [];\r\n  //   this.groupSelected.filters.forEach(filter => {\r\n  //     indexArray.forEach(index => {\r\n  //       if (filter.index === index) {\r\n  //         const select = document.getElementById(filter.codeField);\r\n  //         select.innerHTML = '';\r\n  //         const phOption = document.createElement('option');\r\n  //         phOption.text = filter.firstOption;\r\n  //         phOption.value = '';\r\n  //         select.appendChild(phOption);\r\n  //         const restoreOption = document.createElement('option');\r\n  //         // restoreOption.text = filter.firstOption;\r\n  //         restoreOption.text = 'Vacío';\r\n  //         restoreOption.value = '0';\r\n  //         restoreOption.selected = false;\r\n  //         // restoreOption.disabled = false;\r\n  //         select.appendChild(restoreOption);\r\n  //         newAffectedFilters.push(filter.filterAffected);\r\n  //       }\r\n  //     });\r\n  //   });\r\n\r\n  //   return newAffectedFilters.flat();\r\n  // },\r\n\r\n  getCountByWhere(ulr, where) {\r\n    const deferred = new Deferred();\r\n    const queryTask = new QueryTask(ulr);\r\n    const query = new Query();\r\n    query.where = where;\r\n    query.returnGeometry = false;\r\n    queryTask.executeForCount(query)\r\n      .then(response => {\r\n        deferred.resolve(response);\r\n      })\r\n      .catch(err => {\r\n        deferred.reject(err);\r\n      });\r\n    return deferred.promise;\r\n  },\r\n\r\n  makeSelectorLayers(layers) {\r\n    layers.sort((a, b) => a.index - b.index);\r\n    this.formRadioContainersApCs.innerHTML = '';\r\n\r\n    let idSelected;\r\n\r\n    layers.forEach(layer => {\r\n\r\n      const radioItemContainer = document.createElement('div');\r\n      radioItemContainer.classList.add('radioItemContainerCs');\r\n      const input = document.createElement('input');\r\n      input.type = 'radio';\r\n      input.name = 'searchType';\r\n      input.id = layer.id;\r\n      if (layer.selected) {\r\n        idSelected = layer.id;\r\n      };\r\n      radioItemContainer.appendChild(input);\r\n      const label = document.createElement('label');\r\n      label.for = layer.id;\r\n      label.innerHTML = layer.label;\r\n      radioItemContainer.appendChild(label);\r\n      if (!layer.visible) {\r\n        // display none\r\n        radioItemContainer.style.display = 'none';\r\n      }\r\n      this.formRadioContainersApCs.appendChild(radioItemContainer);\r\n    });\r\n    dojo.query('.radioItemContainerCs input').on('click', this.handleRadioButtonClick.bind(this));\r\n    // execute event ckecked the radio button selected by id programmatically in dom\r\n    if (idSelected) {\r\n      document.getElementById(idSelected).checked = true;\r\n      document.getElementById(idSelected).click();\r\n    };\r\n  },\r\n\r\n  handleRadioButtonClick(event) {\r\n    const layerSelected = this.groupSelected.layersForm.layers.find(layer => layer.id === event.target.id);\r\n    this.layersSelected = layerSelected;\r\n    if (layerSelected) {\r\n      this.groupSelected.layersForm.layers.forEach(layer => {\r\n        if (layer.id === event.target.id) {\r\n        } else {\r\n          layer.layersId.forEach(layerId => {\r\n            if (this.map.getLayer(layerId).visible & layerSelected.layersId[0] != layerId) {\r\n              this.map.getLayer(layerId).setVisibility(false)\r\n            };\r\n          });\r\n        }\r\n      });\r\n      layerSelected.layersId.forEach(layerId => {\r\n        if (!this.map.getLayer(layerId).visible) {\r\n          this.map.getLayer(layerId).setVisibility(true);\r\n        };\r\n      });\r\n\r\n      this.urlLayerSelected = this.map.getLayer(layerSelected.layersId[0]).url;\r\n      this.labelLayerSelected = layerSelected.label;\r\n    }\r\n  },\r\n\r\n  manageWhere() {\r\n    let where = [];\r\n    this.groupSelected.filters.forEach(filter => {\r\n      const select = document.getElementById(filter.codeField);\r\n      // get value selected\r\n      const selectedIndex = select.selectedIndex;\r\n      if (selectedIndex > 1) {\r\n        // create where\r\n        const selectedValue = select.options[selectedIndex].value;\r\n        where.push(`(${filter.codeField} = '${selectedValue}')`);\r\n      };\r\n    });\r\n    // console.log('where', where.join(' AND '));\r\n    return where.join(' AND ');\r\n  },\r\n\r\n  manageWhereLimits() {\r\n    let where = [];\r\n    this.groupSelected.filters.forEach(filter => {\r\n      if (filter.anotherZoom) {\r\n        const select = document.getElementById(filter.codeField);\r\n        // get value selected\r\n        const selectedIndex = select.selectedIndex;\r\n        if (selectedIndex > 1) {\r\n          // create where\r\n          const selectedValue = select.options[selectedIndex].value;\r\n          where.push(`(${filter.anotherZoom.field} = '${selectedValue}')`);\r\n        };\r\n      }\r\n    });\r\n\r\n    if (where.length === 0) {\r\n      return this.whereDefault;\r\n    };\r\n    // console.log('where', where.join(' AND '));\r\n    return where.join(' AND ');\r\n  },\r\n\r\n  resetAllOpionSelected(evt) {\r\n    // execute buildFormSearchCs\r\n    // this.busyIndicator.show();\r\n\r\n    this.buildFormSearchCs();\r\n    this.layersSelected.layersId.forEach(layerId => {\r\n      this.map.getLayer(layerId).setDefinitionExpression(this.whereDefault);\r\n    });\r\n    this.executeHomeExtent();\r\n  },\r\n\r\n  // onClose(){\r\n  //   console.log('DynamicSearchWidgetCunaMas::onClose');\r\n  // },\r\n  // onMinimize(){\r\n  //   console.log('DynamicSearchWidgetCunaMas::onMinimize');\r\n  // },\r\n  // onMaximize(){\r\n  //   console.log('DynamicSearchWidgetCunaMas::onMaximize');\r\n  // },\r\n  // onSignIn(credential){\r\n  //   console.log('DynamicSearchWidgetCunaMas::onSignIn', credential);\r\n  // },\r\n  // onSignOut(){\r\n  //   console.log('DynamicSearchWidgetCunaMas::onSignOut');\r\n  // }\r\n  // onPositionChange(){\r\n  //   console.log('DynamicSearchWidgetCunaMas::onPositionChange');\r\n  // },\r\n  // resize(){\r\n  //   console.log('DynamicSearchWidgetCunaMas::resize');\r\n  // }\r\n});\r\n"]}